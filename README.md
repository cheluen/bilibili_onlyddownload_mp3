# Bilibili音频下载器

这是一个油猴(Tampermonkey)脚本，用于从B站视频中提取音频并下载为MP3或M4A格式。无需额外软件，直接在浏览器中操作即可获取高质量音频文件。

## 功能特点

- 在B站视频页面添加音频下载按钮
- 自动提取视频中的最高质量音频
- 支持下载M4A和MP3两种格式
- 显示下载进度和状态
- 支持多分P视频选择
- 支持所有B站视频页面（包括普通视频、番剧、电影等）

## 安装方法

1. 首先确保您的浏览器已安装 [Tampermonkey](https://www.tampermonkey.net/) 扩展
2. 点击 [这里](https://github.com/cheluen/bilibili_onlyddownload_mp3/raw/refs/heads/main/bilibili_audio_downloader.user.js) 安装脚本（或者将`bilibili_audio_downloader.user.js`文件拖拽到Tampermonkey扩展页面）
3. 在弹出的安装页面中点击「安装」按钮

## 使用方法

1. 打开任意B站视频页面
2. 在视频播放器下方找到「下载M4A」和「下载MP3」两个按钮
3. 根据需要选择下载格式：
   - **下载M4A**：原始高质量音频格式，文件较小，音质最佳
   - **下载MP3**：转换为WAV格式，兼容性更好，适合老设备
4. 点击对应按钮开始下载过程
5. 等待下载完成后，音频文件将自动保存到您的下载文件夹中

## 注意事项

- 本脚本仅供学习和个人使用
- 请尊重创作者的版权，不要将下载的音频用于商业用途
- 由于B站网页结构可能会变化，如果脚本无法正常工作，请检查是否有更新版本
- 下载速度取决于您的网络环境和B站服务器状态

## 技术说明

脚本使用了以下技术：
- GM_xmlhttpRequest 用于跨域请求B站API
- GM_download 用于下载音频文件
- 使用B站官方API获取视频信息和音频流地址
- 自动处理音频格式转换

## 常见问题

**Q: 为什么有些视频无法下载？**
A: 部分版权受限的视频可能无法正常提取音频，这是由于B站的版权保护机制导致的。

**Q: 下载的音频质量如何？**
A: 脚本会自动选择可用的最高音质进行下载，通常为320kbps或192kbps。

**Q: M4A和MP3格式有什么区别？**
A:
- **M4A格式**：B站原始音频格式，音质最佳，文件较小，现代设备都支持
- **MP3格式**：转换为WAV格式下载，兼容性最好，适合老设备或有特殊需求的用户

**Q: 为什么MP3下载的是WAV格式？**
A: 真正的MP3编码需要复杂的音频编码库，在浏览器环境中实现较困难。WAV格式是无损的，兼容性极好，大部分播放器都支持，可以满足对兼容性的需求。

**Q: 为什么MP3转换时不会卡住页面了？**
A: v0.5版本采用了异步分块处理技术，将大文件的转换过程分解为小块，每处理一块就让出控制权给浏览器UI线程，同时显示实时进度，确保页面始终保持响应。

## 更新日志

### v0.5 (2024-12-15)
- 🚀 **重大性能优化**：修复MP3转换时页面卡顿问题
- 🎨 **全新UI设计**：精美的渐变按钮和现代化界面
- 📊 **实时进度显示**：添加详细的下载和转换进度条
- ⚡ **异步处理**：音频转换采用分块异步处理，不再阻塞页面
- 🎭 **动画效果**：按钮悬停效果、加载动画和状态反馈
- 🔧 **错误处理优化**：更好的错误提示和自动回退机制

### v0.4 (2024-12-15)
- 🎵 新增MP3格式下载支持（实际为WAV格式）
- 🎨 重新设计用户界面，提供M4A和MP3两个下载选项
- 🔧 优化音频转换逻辑，支持格式选择
- 📱 提高兼容性，满足不同设备需求
- 🎯 改进按钮状态管理和用户反馈

### v0.3 (2024-12-15)
- 修复页面元素选择器兼容性问题
- 增加多分P视频支持
- 优化SPA页面切换时的按钮重复添加问题
- 改进错误处理和用户反馈
- 优化下载逻辑，提高稳定性
- 移除未使用的lamejs依赖

### v0.2 (2023-12-15)
- 优化下载进度显示
- 修复部分视频无法下载的问题
- 提高音频转换质量

### v0.1 (初始版本)
- 实现基本的音频提取和下载功能
- 添加下载状态显示
- 支持高质量音频选择

## 许可证

本项目采用 MIT 许可证，详情请参阅 LICENSE 文件。